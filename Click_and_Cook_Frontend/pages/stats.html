<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <script type="module" src="../js/main.js"></script>
    <script type="module">
        // Importar funciones de API para obtener estadísticas (Asume que las tendrás en api.js)
        // import { getTopIngredients, getCategoryDistribution } from '../js/api.js';
        import { showMessage } from '../js/dom.js';

        document.addEventListener('DOMContentLoaded', async () => {
            const topIngredientsList = document.getElementById('top-ingredients-list');
            const topCategoriesList = document.getElementById('top-categories-list');
            const categoryChartCanvas = document.getElementById('categoryChart');

            // Definir los colores directamente en JavaScript para Chart.js
            const primaryColor = '#E9522D'; // Naranja Terracota
            const secondaryColor1 = '#8BC34A'; // Verde Aguacate
            const secondaryColor2 = '#FFC107'; // Amarillo Mostaza
            const accentColor = '#00BCD4'; // Azul Turquesa
            const textDark = '#333333'; // Gris oscuro

            // --- Lógica para Ingredientes Más Usados ---
            try {
                // Aquí deberías llamar a tu API de backend para obtener los ingredientes.
                // Ejemplo de datos simulados:
                const topIngredients = [
                    { name: 'Cebolla', count: 120 },
                    { name: 'Ajo', count: 110 },
                    { name: 'Tomate', count: 95 },
                    { name: 'Pollo', count: 80 },
                    { name: 'Sal', count: 150 },
                ].sort((a,b) => b.count - a.count).slice(0, 5); // Ordena y toma los 5 primeros

                if (topIngredients && topIngredients.length > 0) {
                    topIngredientsList.innerHTML = ''; // Limpiar
                    topIngredients.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `<span>${item.name}</span> <span>${item.count} usos</span>`;
                        topIngredientsList.appendChild(li);
                    });
                } else {
                    topIngredientsList.innerHTML = '<li>No hay datos de ingredientes aún.</li>';
                }
            } catch (error) {
                console.error('Error al cargar ingredientes más usados:', error);
                showMessage('Error al cargar estadísticas de ingredientes.', 'error');
                topIngredientsList.innerHTML = '<li>Error al cargar datos.</li>';
            }

            // --- Lógica para Categorías Populares ---
            try {
                // Aquí deberías llamar a tu API de backend para obtener las categorías.
                // Ejemplo de datos simulados:
                const topCategories = [
                    { name: 'Plato Principal', count: 200 },
                    { name: 'Postres', count: 150 },
                    { name: 'Desayunos', count: 80 },
                    { name: 'Vegetariano', count: 70 },
                    { name: 'Sopas', count: 50 },
                ].sort((a,b) => b.count - a.count).slice(0, 5);

                if (topCategories && topCategories.length > 0) {
                    topCategoriesList.innerHTML = ''; // Limpiar
                    topCategories.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `<span>${item.name}</span> <span>${item.count} recetas</span>`;
                        topCategoriesList.appendChild(li);
                    });
                } else {
                    topCategoriesList.innerHTML = '<li>No hay datos de categorías aún.</li>';
                }

                // --- Lógica para Gráfico de Distribución de Categorías (Chart.js) ---
                if (categoryChartCanvas) {
                    const ctx = categoryChartCanvas.getContext('2d');
                    // Preparar los datos para Chart.js
                    const labels = topCategories.map(cat => cat.name);
                    const data = topCategories.map(cat => cat.count);
                    const backgroundColors = [
                        'rgba(233, 82, 45, 0.7)',  // primary-color
                        'rgba(139, 195, 74, 0.7)', // secondary-color-1
                        'rgba(255, 193, 7, 0.7)',  // secondary-color-2
                        'rgba(0, 188, 212, 0.7)',  // accent-color
                        'rgba(51, 51, 51, 0.7)',   // text-dark (oscuro, pero útil)
                        'rgba(255, 99, 132, 0.7)' // Otro color si tienes más de 5
                    ];

                    new Chart(ctx, {
                        type: 'doughnut', // Puedes usar 'bar', 'pie', etc.
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: backgroundColors.slice(0, labels.length),
                                borderColor: 'white',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'Distribución de Recetas por Categoría',
                                    font: {
                                        size: 18,
                                        family: 'Montserrat'
                                    },
                                    color: primaryColor // USAR LA VARIABLE JS DEFINIDA ARRIBA
                                }
                            }
                        }
                    });
                }

            } catch (error) {
                console.error('Error al cargar categorías o gráfico:', error);
                showMessage('Error al cargar estadísticas de categorías.', 'error');
                topCategoriesList.innerHTML = '<li>Error al cargar datos.</li>';
            }
        });
    </script>